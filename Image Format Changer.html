<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<title>Image Converter + Compression</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root{
  --primary-gradient: linear-gradient(135deg,#f97316,#ea580c,#c2410c);
  --btn: linear-gradient(135deg,#fb923c,#f97316);
  --btn-hover: linear-gradient(135deg,#ea580c,#c2410c);
  --card-bg: rgba(255,255,255,0.95);
  --text:#1f2937;
}
body{
  margin:0;
  min-height:100vh;
  background: linear-gradient(135deg,#3b82f6,#1e3a8a);
  display:flex; flex-direction:column; align-items:center; padding:28px 12px 160px;
  font-family:Arial,sans-serif; transition:background .4s,color .4s; color:var(--text);
}
body.dark{background: linear-gradient(135deg,#0f172a,#0b1120); color:#f3f4f6;}
.card{width:100%; max-width:720px; background:var(--card-bg); border-radius:14px;
  box-shadow:0 12px 30px rgba(255,255,255,0.06),0 6px 18px rgba(0,0,0,0.12);
  backdrop-filter: blur(10px); margin-top:12px; transition:background .4s,color .4s;
}
body.dark .card{background:rgba(31,41,55,0.92); color:#f1f5f9; box-shadow:0 12px 30px rgba(0,0,0,0.6);}
.card-header{display:flex; align-items:center; justify-content:space-between;
  padding:14px 18px; background:var(--primary-gradient); color:#fff; border-radius:14px 14px 0 0;}
.card-header h2{margin:0; font-size:18px;}
.switch{position:relative; display:inline-block; width:40px; height:20px;}
.switch input{opacity:0; width:0; height:0;}
.slider{position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0;
  background:#ccc; border-radius:20px; transition:.4s;}
.slider:before{position:absolute; content:""; height:16px; width:16px;
  left:2px; bottom:2px; background:white; border-radius:50%; transition:.4s;}
.switch input:checked + .slider{background:#f97316;}
.switch input:checked + .slider:before{transform:translateX(20px);}
.card-body{padding:18px;}
.dropzone{border:2px dashed rgba(0,0,0,0.08); border-radius:10px; padding:18px;}
body.dark .dropzone{border:2px dashed rgba(255,255,255,0.2);}
.file-input input{display:none;}
.file-input label{cursor:pointer; padding:8px 12px; border-radius:8px;
  background:var(--btn); color:#fff; font-weight:700;}
.thumbs{margin-top:16px; display:flex; flex-direction:column; gap:10px; max-height:300px; overflow:auto;}
.thumb{display:flex; gap:12px; align-items:center; padding:8px; border-radius:10px; background:rgba(0,0,0,0.05); flex-direction:column;}
body.dark .thumb{background:rgba(255,255,255,0.08);}
.thumb img{width:72px; height:56px; object-fit:cover; border-radius:6px;}
.meta{flex:1; text-align:center; font-size:13px;}
.thumb-size{font-size:12px; color:#16a34a; margin-top:4px;}
body.dark .thumb-size{color:#4ade80;}
.primary-btn, .secondary-btn{padding:10px 14px; border-radius:10px; border:none; cursor:pointer;
  background:var(--btn); color:#fff; font-weight:700; transition:transform .2s;}
.primary-btn:hover, .secondary-btn:hover{transform:scale(1.05); background:var(--btn-hover);}
.btn-row{margin-top:16px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
.secondary-row{margin-top:12px; display:flex; gap:10px;}
.modal{position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.4); display:none;
  justify-content:center; align-items:center; z-index:1000;}
.modal-content{background:linear-gradient(135deg,#f97316,#ea580c,#c2410c); color:#fff; padding:16px 20px;
  border-radius:12px; box-shadow:0 10px 25px rgba(0,0,0,0.5); text-align:center; font-size:16px; font-weight:600;
  opacity:0; transform:scale(0.7); animation:fadePop 0.4s forwards; min-width:180px;}
body.dark .modal-content{background:linear-gradient(135deg,#0f172a,#1e293b,#1f2937); color:#f3f4f6;}
@keyframes fadePop{0%{opacity:0; transform:scale(0.7);} 100%{opacity:1; transform:scale(1);}}
.footer{position:fixed; bottom:0; left:0; width:100%; padding:10px 0; text-align:center;
  background:linear-gradient(135deg,#f97316,#ea580c,#c2410c); color:#fff;}
.footer .socials{display:flex; gap:14px; justify-content:center; margin-top:6px;}
.footer .socials a{font-size:18px; color:#fff; transition:.24s;}
.footer .socials a:hover{transform:scale(1.2); text-shadow:0 0 8px rgba(255,255,255,0.7);}
#convertInfo{margin-top:12px; font-size:14px; font-weight:600; color:#16a34a;}
body.dark #convertInfo{color:#4ade80;}
</style>
</head>
<body>
<div class="card">
  <div class="card-header">
    <h2>Image Converter + Compression</h2>
    <label class="switch"><input id="darkToggle" type="checkbox"><span class="slider"></span></label>
  </div>
  <div class="card-body">
    <div id="dropzone" class="dropzone">
      <p><b>Drag & drop images here</b></p>
      <div class="file-input">
        <input id="fileInput" type="file" accept="image/*" multiple />
        <label for="fileInput"><i class="fa-solid fa-upload"></i> Choose Images</label>
      </div>
    </div>
    <div class="thumbs" id="thumbs"></div>

    <div class="btn-row">
      <label><b>Output Format:</b></label>
      <select id="formatSelect"><option value="image/jpeg">JPEG</option><option value="image/webp">WEBP</option><option value="image/png">PNG</option></select>
      <label><b>Target Size (KB):</b></label>
      <select id="qualitySelect">
        <option value="20">20 KB</option>
        <option value="30">30 KB</option>
        <option value="50">50 KB</option>
        <option value="100" selected>100 KB</option>
        <option value="150">150 KB</option>
        <option value="300">300 KB</option>
        <option value="500">500 KB</option>
      </select>
      <button id="downloadAll" class="primary-btn"><i class="fa-solid fa-download"></i> Download All</button>
    </div>
    <div id="convertInfo"></div>
  </div>
</div>

<div id="modal" class="modal"><div class="modal-content"><h3 id="modalMsg">âœ… Conversion Done!</h3></div></div>

<footer class="footer">
      Â© 2025 <span>Public CSC</span> | All Rights Reserved
  <div class="socials">
    <a href="https://instagram.com/public.csc"><i class="fab fa-instagram" style="color:#E4405F;"></i></a>
    <a href="https://t.me/tgdanzer"><i class="fab fa-telegram" style="color:#0088cc;"></i></a>
    <a href="https://wa.me/8051450233"><i class="fab fa-whatsapp" style="color:#25D366;"></i></a>
    <a href="https://www.facebook.com/share/1JavTLfsyU/"><i class="fab fa-facebook" style="color:#1877F2;"></i></a>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script>
const fileInput=document.getElementById('fileInput');
const thumbs=document.getElementById('thumbs');
const darkToggle=document.getElementById('darkToggle');
const formatSelect=document.getElementById('formatSelect');
const qualitySelect=document.getElementById('qualitySelect');
const modal=document.getElementById('modal');
const modalMsg=document.getElementById('modalMsg');
const convertInfo=document.getElementById('convertInfo');
const downloadAll=document.getElementById('downloadAll');

let files=[];

fileInput.addEventListener('change', e=>{
  files=[...e.target.files];
  renderThumbs();
  updateConvertedSizes();
});

qualitySelect.addEventListener('change',updateConvertedSizes);
formatSelect.addEventListener('change',updateConvertedSizes);

function renderThumbs(){
  thumbs.innerHTML='';
  files.forEach(f=>{
    const div=document.createElement('div');
    div.className='thumb';
    const sizeKB=(f.size/1024).toFixed(2);
    div.innerHTML=`<img src="${URL.createObjectURL(f)}"><div class="meta">${f.name}</div>
      <div class="thumb-size">Original: ${sizeKB>1024?((sizeKB/1024).toFixed(2)+' MB'):sizeKB+' KB'}<br>Converted: - </div>`;
    thumbs.appendChild(div);
  });
}

function showModal(msg){
  modalMsg.textContent=msg;
  modal.style.display="flex";
  modal.firstElementChild.style.animation='none';
  void modal.firstElementChild.offsetWidth;
  modal.firstElementChild.style.animation='fadePop 0.4s forwards';
  setTimeout(()=>{ modal.style.display="none"; },2000);
}

function convertImagePreview(file,format,targetKB,callback){
  const reader=new FileReader();
  reader.onload=e=>{
    const img=new Image();
    img.onload=()=>{
      let canvas=document.createElement('canvas');
      let width=img.width, height=img.height;
      canvas.width=width; canvas.height=height;
      const ctx=canvas.getContext('2d');
      ctx.drawImage(img,0,0,width,height);

      let quality=0.9;
      const maxIter=10;
      let iter=0;

      function tryCompress(){
        canvas.toBlob(blob=>{
          const kb=blob.size/1024;
          if(format!=="image/png" && kb>targetKB && iter<maxIter && quality>0.1){
            quality-=0.1; iter++; tryCompress();
          } else if(format!=="image/png" && kb>targetKB && iter>=maxIter){
            width=Math.floor(width*0.9); height=Math.floor(height*0.9);
            canvas.width=width; canvas.height=height;
            const ctx2=canvas.getContext('2d'); ctx2.drawImage(img,0,0,width,height);
            quality=0.9; iter=0; tryCompress();
          } else { callback(blob); }
        },format,quality);
      }
      tryCompress();
    };
    img.src=e.target.result;
  };
  reader.readAsDataURL(file);
}

function updateConvertedSizes(){
  if(!files.length) return;
  const format=formatSelect.value;
  const targetKB=parseInt(qualitySelect.value);

  files.forEach((file,i)=>{
    convertImagePreview(file,format,targetKB,blob=>{
      const thumbDiv=[...thumbs.children][i];
      const sizeKB=(blob.size/1024).toFixed(2);
      const sizeStr=sizeKB>1024?((sizeKB/1024).toFixed(2)+' MB'):sizeKB+' KB';
      const sizeDiv=thumbDiv.querySelector('.thumb-size');
      sizeDiv.innerHTML=`Original: ${(file.size/1024).toFixed(2)} KB<br>Converted: ${sizeStr}`;
      convertInfo.innerHTML=`ðŸ’¾ Last Converted Size: <b>${sizeStr}</b>`;
    });
  });
}

// Download all images as ZIP
downloadAll.onclick=()=>{
  if(!files.length) return alert("Select images first");
  const format=formatSelect.value;
  const targetKB=parseInt(qualitySelect.value);
  const zip=new JSZip();
  let count=0;

  files.forEach((file,i)=>{
    convertImagePreview(file,format,targetKB,blob=>{
      zip.file(file.name.replace(/\.[^/.]+$/,"")+"."+format.split('/')[1],blob);
      count++;
      if(count===files.length){
        zip.generateAsync({type:"blob"}).then(content=>{
          const url=URL.createObjectURL(content);
          const a=document.createElement('a');
          a.href=url; a.download="Converted_Images.zip";
          a.click();
          showModal("âœ… All Images Downloaded!");
        });
      }
    });
  });
};

darkToggle.onchange=()=>{ document.body.classList.toggle('dark',darkToggle.checked); };
</script>
</body>
</html>
